---

- name: Test integration playbook
  hosts: all
  vars:
    sift_docker: false
    ## xenial on container has issue to install bluez which is required for unity
    # sift_do_x11: false
  pre_tasks:
    - name: Debian | Refresh apt cache
      ansible.builtin.apt:
        update_cache: yes
        cache_valid_time: 3600
      when: ansible_os_family == "Debian"
    - name: Debug | var ansible_python*
      ansible.builtin.debug:
        var: "{{ item }}"
      loop:
        - ansible_python_interpreter
        - ansible_python
        - ansible_env
    - name: Ensure python3-debian is present - geerlingguy.docker
      ansible.builtin.pip:
        name: python3-debian
        state: present
        executable: "{{ ansible_python_interpreter | default(ansible_python) | replace('python', 'pip') }}"
      when: >
        (ansible_env['GITHUB_ACTIONS'] is defined and ansible_env['GITHUB_ACTIONS'] == 'true') or
        (ansible_env['RUNNER_ENVIRONMENT'] is defined and ansible_env['RUNNER_ENVIRONMENT'] == 'github-hosted')
    - name: Debug | var ansible_virtualization_type
      ansible.builtin.debug:
        var: ansible_virtualization_type
  roles:
    - geerlingguy.docker
    - juju4.sift
