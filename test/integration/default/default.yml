---

- name: Test integration playbook
  hosts: all
  vars:
    sift_docker: false
    ## xenial on container has issue to install bluez which is required for unity
    # sift_do_x11: false
  pre_tasks:
    - name: Debian | Refresh apt cache
      ansible.builtin.apt:
        update_cache: yes
        cache_valid_time: 3600
      when: ansible_facts['os_family'] == "Debian"
    - name: Debug | var ansible_python*
      ansible.builtin.debug:
        var: "{{ item }}"
      loop:
        - ansible_python_interpreter
        - ansible_python
        - ansible_facts['env']
    - name: Ensure python-debian is present - geerlingguy.docker
      ansible.builtin.pip:
        name: python-debian
        state: present
        executable: "{{ ansible_python_interpreter | default(ansible_python['executable']) | replace('python', 'pip') }}"
      when: >
        (ansible_facts['env']['GITHUB_ACTIONS'] is defined and ansible_facts['env']['GITHUB_ACTIONS'] == 'true') or
        (ansible_facts['env']['RUNNER_ENVIRONMENT'] is defined and ansible_facts['env']['RUNNER_ENVIRONMENT'] == 'github-hosted') or
        (ansible_facts['env']['RUNNER_TOOL_CACHE'] is defined)
    - name: Debug | var ansible_facts['virtualization_type']
      ansible.builtin.debug:
        var: ansible_facts['virtualization_type']
  roles:
    - geerlingguy.docker
    - juju4.sift
